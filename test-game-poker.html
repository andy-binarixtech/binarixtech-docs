<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>POKER GAME</title>

  <style>
    #log {
      font-family: monospace;
      border: 1px solid #ccc;
      padding: 8px;
      max-height: 300px;
      overflow-y: auto;
      background: #f9f9f9;
    }
    .log-entry {
      display: flex;
      border-bottom: 1px solid #eee;
      padding: 4px 0;
      align-items: center;
    }
    .log-time {
      width: 200px;
      color: #888;
      font-weight: bold;
    }
    .log-msg {
      flex: 1;
      display: flex;
      align-items: center;
      gap: 8px;
    }
    .log-msg.sent {
      color: green;
    }
    .log-msg.received {
      color: blue;
    }
    .log-msg.error {
      color: red;
    }
    .log-icon {
      font-size: 1.2em;
    }
  </style>
</head>
<body>
  <h2>Sicbo WebSocket Client</h2>
  <div style="padding: 10px;">
    <button onclick="connect()">Káº¿t ná»‘i</button>
    <button onclick="login()">Login</button>
    <button onclick="joinRoom()">Join Room</button>
    <button onclick="ping()">PING</button>
    <button onclick="searchRoom()">search room</button>
  </div>

  <div id="controls" style="padding: 10px;">
    <button id="clearBtn">ðŸ§¹ Clear Log</button>
  </div>

  <pre id="log"></pre>

  <script>
    let socket;
    const zoneName = 'SicboZone';
    const pluginName = 'pokerGame';

    function logNative(msg) {
      const timestamp = new Date().toISOString();
      document.getElementById("log").textContent += timestamp + " : " + msg + "\n";
    }

    function log(msg, type="default") {
      const timestamp = new Date().toLocaleString();
      const logContainer = document.getElementById("log");

      const entry = document.createElement("div");
      entry.className = "log-entry";

      const timeCol = document.createElement("div");
      timeCol.className = "log-time";
      timeCol.textContent = timestamp;

      const msgCol = document.createElement("div");
      msgCol.className = "log-msg " + type;

      const icon = document.createElement("span");
      icon.className = "log-icon";

      // chá»n icon theo loáº¡i log
      switch(type) {
        case "sent": icon.textContent = "ðŸ“¤"; break;
        case "received": icon.textContent = "ðŸ“¥"; break;
        case "error": icon.textContent = "âš ï¸"; break;
        default: icon.textContent = "â„¹ï¸";
      }

      const text = document.createElement("span");
      text.textContent = msg;

      msgCol.appendChild(icon);
      msgCol.appendChild(text);

      entry.appendChild(timeCol);
      entry.appendChild(msgCol);
      logContainer.appendChild(entry);

      logContainer.scrollTop = logContainer.scrollHeight;
    }

    function connect() {
      // Ä‘á»•i port náº¿u server báº¡n cháº¡y khÃ¡c
      socket = new WebSocket("ws://localhost:8892/websocket");

      socket.onopen = () => {
        log("Connected to server");
        socket.send(JSON.stringify({ action: "join_poker_game" }));
      };

      socket.onmessage = (event) => {
        log("> Received: " + event.data);
      };

      socket.onclose = () => {
        log("Connection closed");
      };

      socket.onerror = (err) => {
        log("Error: " + err, "error");
      };
    }

    function login() {
      if (!isSocketConnected()) {
        return;
      }
      const loginMessage = [
        1,
        zoneName,
        "user_andy", 
        "pw_123", 
        {}
      ]

      const msg = loginMessage;
      socket.send(JSON.stringify(msg));
      log("Login message: " + JSON.stringify(msg));
    }

    function placeBet(side, amount) {
      if (!isSocketConnected()) {
        return;
      }

      const place_bet_msg = {
        action: "place_bet",
        payload: {
          roundId: "R1",
          side: side,
          amount: amount
        }
      };
      const zonePluginMessage = [
        6,
        zoneName,
        pluginName,
      ];
      zonePluginMessage.push(place_bet_msg);

      const msg = zonePluginMessage;
      socket.send(JSON.stringify(msg));
      log("Sent : " + JSON.stringify(msg));
    }

    function searchRoom() {
      if (!isSocketConnected()) {
        return;
      }
      const zonePluginMessage = [
        6,
        zoneName,
        pluginName,
        {
          "action": "search_rooms"
        }
      ];
      const msg = zonePluginMessage;
      socket.send(JSON.stringify(msg));
      log("Sent: " + JSON.stringify(msg));
    }

    function joinRoom() {
      if (!isSocketConnected()) {
        return;
      }
      const joinRoomMessage = [
        3, 
        zoneName, 
        123456, 
        "pwd_123456"
      ]
      const msg = joinRoomMessage;
      socket.send(JSON.stringify(msg));
      log("Sent: " + JSON.stringify(msg));
    }

    function ping() {
      if (!isSocketConnected()) {
        return;
      }
      const msg = {
        action: "ping",
        requestId: 123456
      };
      socket.send(JSON.stringify(msg));
      log("Sent : " + JSON.stringify(msg));
    }

    function isSocketConnected() {
      if (!socket || socket.readyState !== WebSocket.OPEN) {
        log("Socket chÆ°a káº¿t ná»‘i", "error");
        return false;
      }
      return true;
    }

    document.getElementById("clearBtn").addEventListener("click", () => {
      document.getElementById("log").innerHTML = "";
    });
  </script>
</body>
</html>
