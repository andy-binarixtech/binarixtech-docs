<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Sicbo Client Test</title>
</head>
<body>
  <h2>Sicbo WebSocket Client</h2>
  <button onclick="connect()">K·∫øt n·ªëi</button>
  <button onclick="get_user_info()">get user info</button>
  <button onclick="get_table_info()">get table info</button>
  <button onclick="placeBet('TAI', 1000)">ƒê·∫∑t T√†i 1000</button>
  <button onclick="placeBet('XIU', 2000)">ƒê·∫∑t X·ªâu 2000</button>
  <pre id="log"></pre>

  <script>
    let socket;

    function log(msg) {
      const timestamp = new Date().toISOString();
      document.getElementById("log").textContent += timestamp + " : " + msg + "\n";
    }

    function connect() {
      // ƒë·ªïi port n·∫øu server b·∫°n ch·∫°y kh√°c
      socket = new WebSocket("ws://43.199.112.106:8897/websocket");

      socket.onopen = () => {
        log("‚úÖ Connected to server");
        // ƒëƒÉng k√Ω nh·∫≠n v√≤ng ch∆°i
        socket.send(JSON.stringify({ action: "subscribe_rounds" }));
      };

      socket.onmessage = (event) => {
        log("üì© Received: " + event.data);
      };

      socket.onclose = () => {
        log("‚ùå Connection closed");
      };

      socket.onerror = (err) => {
        log("‚ö†Ô∏è Error: " + err);
      };
    }

    function placeBet(side, amount) {
      if (!socket || socket.readyState !== WebSocket.OPEN) {
        log("‚ö†Ô∏è Socket ch∆∞a k·∫øt n·ªëi");
        return;
      }
      const msg = {
        action: "place_bet",
        payload: {
          roundId: "R1", // ho·∫∑c roundId server broadcast
          side: side,
          amount: amount
        }
      };
      socket.send(JSON.stringify(msg));
      log("‚û°Ô∏è Sent bet: " + JSON.stringify(msg));
    }

    function get_user_info() {
      if (!socket || socket.readyState !== WebSocket.OPEN) {
        log("‚ö†Ô∏è Socket ch∆∞a k·∫øt n·ªëi");
        return;
      }
      const msg = {
        action: "get_user_info",
        requestId: 123456
      };
      socket.send(JSON.stringify(msg));
      log("‚û°Ô∏è Sent bet: " + JSON.stringify(msg));
    }

    function get_table_info() {
      if (!socket || socket.readyState !== WebSocket.OPEN) {
        log("‚ö†Ô∏è Socket ch∆∞a k·∫øt n·ªëi");
        return;
      }
      const msg = {
        action: "get_table_info",
        payload: {
          
        }
      };
      socket.send(JSON.stringify(msg));
      log("‚û°Ô∏è table info: " + JSON.stringify(msg));
    }
  </script>
</body>
</html>
